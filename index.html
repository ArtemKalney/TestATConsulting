<!DOCTYPE html>

<html>

<head>
<meta charset="utf-8">

<style>
    body {
        margin: 0;
    }

    * {
        box-sizing: border-box;
    }

    form {
        width: 40%;
    }

    input[type=text], input[type=number], select, textarea {
         width: 60%;
         display: inline-block;
         border: 1px solid #ccc;
         background-color: #f2f2f2;
         border-radius: 4px;
         padding: 5px;
         float: right;
         margin: 10px 4%;
     }

    label {
        width: 32%;
        display: inline-block;
        float: right;
        text-align: right;
        margin: 10px 0;
        padding: 5px;
    }

    input[type=submit] {
        display: inline-block;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 0 0 10px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        float: right;
    }

    input[type=submit]:hover {
        background-color: #45a049;
    }

    .field {
        width: 100%;
        position: relative;
        border: 2px dashed lightgray;
        margin: 10px;

        content: "";
        clear: both;
        display: table;
    }

    .header {
        height: 25px;
        background-color: lightblue;
        padding: 3px;
        color: steelblue;
    }

    .header-field {
        border-color: lightblue;
        height: 50px;
    }

    .inherit {
        width: 92%;
        margin: 10px 4%;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        border: none;
    }

    .error {
        color: red;
    }

    .tooltip {
        background-color: black;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px 0;
        z-index: 1;
        position: absolute;
    }
</style>
</head>

<body>
<form autocomplete="on">
    <div class="field header-field">
        <div class="header">Форма запроса</div>
    </div>

    <div class="field">
             <input id="lname" type="text" name="Фамилия" maxlength="40" required>
             <label for="lname">Фамилия</label>
    </div>

    <div class="field">
        <input id="fname" type="text" name="Имя" maxlength="40" required>
        <label for="fname">Имя</label>
    </div>

    <div class="field">
        <input id="patr" type="text" name="Отчество" maxlength="40">
        <label for="patr">Отчество</label>
    </div>

    <div class="field">
        <input id="snil" type="text" name="СНИЛС" title="Введите числа вида nnn-nnn-nnn nn"
               pattern="\d{3}-\d{3}-\d{3} \d{2}" required>
        <label for="snil">СНИЛС</label>
    </div>

    <div class="field">
        <input id="bdate" type="text" name="ДатаРождения" title="Введите дату вида dd.mm.yyyy"
               pattern="\d{2}.\d{2}.\d{4}" required>
        <label for="bdate">Дата Рождения</label>
    </div>

    <div class="field">
        <select id="davailable" name="НаличиеДанных" required>
            <option value="ДА">ДА</option>
            <option value="НЕТ">НЕТ</option>
        </select>
        <label for="davailable">Наличие Данных</label>
    </div>

    <div class="field header-field">
        <div class="header">Общая продолжительность стажа на дату обращения гражданина</div>
    </div>

    <div class="field">
        <input id="tlieyers" type="text" name="ОбщаяПродолжительностьСтраховогоСтажаЛет" data-type="number" required>
        <label for="tlieyers">Общая продолжительность страхового стажа лет</label>
    </div>

    <div class="field">
        <textarea id="tliemonths" name="ОбщаяПродолжительностьСтраховогоСтажаМесяцев" data-type="number" rows="2" required></textarea>
        <label for="tliemonths">Общая продолжительность страхового стажа месяцев</label>
    </div>

    <div class="field">
        <input id="tliedays" type="text" name="ОбщаяПродолжительностьСтраховогоСтажаДней" data-type="number" required>
        <label for="tliedays">Общая продолжительность страхового стажа дней</label>
    </div>

    <input type="submit" value="Сохранить" name="bottom">

    <div class="field">
        <div class="header">Форма запроса</div>
        <div class="field inherit">
        <textarea id="req" name="request" rows="2" readonly></textarea>
            <label for="req">Запрос</label>
        </div>
    </div>
</form>

<script>
    var form = document.forms[0];
    var summary =  form.elements.request;
    var bottom = form.elements.bottom;


    form.addEventListener("focus", function(event) {
        var elem = event.target;

        if (elem.classList.contains("error")) {
            elem.classList.remove("error");
            elem.value = "";
        }
    }, true);

    form.onchange = function(event) {
        var elem = event.target;

        if (elem.dataset.type == "number") {
            if (isNaN(elem.value) || elem.value < 0 || elem.value > 99) {
                elem.classList.add("error");
                elem.value = "Введите положительное число меньше 100";
            }
        }
    };

    bottom.onclick = function () {
        if (filled()) {
            summary.value = makeXmlString();
            return false;
        }
    };

    function filled() {
        for(var i=0; i<form.elements.length - 2; i++)
            if(form.elements[i].required && form.elements[i].value == "") return false;

        return true;
    }

    function makeXmlString() {
        var xmlString = "<" + "ЗАПРОС_СВЕДЕНИЙ_О_СТРАХОВОМ_СТАЖЕ" + ">\n";
        for(var i=0; i<form.elements.length - 2; i++) {
            var element =  form.elements[i];

            if (element.id == "tlieyers")
                xmlString += "<" + "ОбщаяПродолжительностьСтраховогоСтажаНаДатуОбращенияГражданинаВОСЗ" + ">\n";
            if(element.value != "")
                xmlString += "<" + element.name + ">" + element.value + "</" + element.name + ">\n";
        }
        xmlString += "</" + "ОбщаяПродолжительностьСтраховогоСтажаНаДатуОбращенияГражданинаВОСЗ" + ">\n";
        xmlString += "</" + "ЗАПРОС_СВЕДЕНИЙ_О_СТРАХОВОМ_СТАЖЕ" + ">\n";

        return xmlString;
    }

    /*function tooltip(node) {
        var tooltip = document.createElement("span");
        var coordNode = node.getBoundingClientRect();
        var coordParentNode = node.parentNode.getBoundingClientRect();
        tooltip.innerHTML = "NaN";
        tooltip.className = "tooltip";
        tooltip.style.left = coordParentNode.left + "px";
        tooltip.style.top = coordParentNode.top + "px";


        node.parentNode.appendChild(tooltip);
    }*/

</script>
</body>
</html>
